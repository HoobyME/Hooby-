<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="overlay" onclick="toggleMenu()"></div>
    
    <div class="sidebar" id="sidebar">
        <h2 style="color: var(--primary-color); margin-bottom: 20px;">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
        <a href="#" onclick="visitMyProfile()" class="menu-item"><i class="fas fa-user-circle"></i> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
        <a href="#" onclick="openInterestsModal()" class="menu-item"><i class="fas fa-shapes"></i> Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</a>
        <div class="menu-item" onclick="toggleDarkMode()" style="cursor: pointer;"><i class="fas fa-moon"></i><span id="darkText">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…</span></div>
        <a href="settings.html" class="menu-item" style="border-top: 1px solid var(--border-color); margin-top: 5px; padding-top: 15px;"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</a>
        <a href="#" onclick="logout()" class="menu-item" style="color: #f44336;"><i class="fas fa-sign-out-alt" style="color: #f44336;"></i> Ø®Ø±ÙˆØ¬</a>
    </div>

    <div class="header">
        <div class="brand-area">
            <div class="app-logo"><img src="logo.png" alt=""> Ù‡ÙˆØ¨ÙŠ</div>
            <a href="notifications.html" class="header-icon"><i class="far fa-bell"></i></a>
            <a href="messages.html" class="header-icon"><i class="far fa-comment-alt"></i></a>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="search.html" class="icon-btn"><i class="fas fa-search"></i></a>
            <div class="icon-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
        </div>
    </div>

    <div class="profile-header">
        <div class="profile-pic-container" id="picContainer">
            <img src="side.png" id="displayPic" class="profile-pic">
            <div class="edit-badge" id="editBadge"><i class="fas fa-camera"></i></div>
        </div>
        <input type="file" id="fileInput" hidden accept="image/*">

        <div class="profile-info">
            <div><h2 id="displayName">Ù…Ø³ØªØ®Ø¯Ù… <i class="fas fa-pen edit-icon" id="editNameIcon" onclick="editName()"></i></h2></div>
            <div><p id="displayBio">... <i class="fas fa-pen edit-icon" id="editBioIcon" onclick="editBio()"></i></p></div>
            
            <div class="profile-actions">
                <button id="followUserBtn" class="action-btn-profile" onclick="toggleFollowUser(this)">Ù…ØªØ§Ø¨Ø¹Ø©</button>
                <button id="messageBtn" class="action-btn-profile" onclick="openChat()">Ù…Ø±Ø§Ø³Ù„Ø©</button>
            </div>
        </div>

        <div class="stats-row">
            <div class="stat-box"><h3>0</h3><span>Ù…Ù†Ø´ÙˆØ±</span></div>
            <div class="stat-box" id="followersBox" onclick="openFollowersList()">
                <h3 id="followersCount">0</h3><span>Ù…ØªØ§Ø¨Ø¹</span>
            </div>
            <div class="stat-box" onclick="openFollowingList()">
                <h3 id="followingCount">0</h3><span>ØªØªØ§Ø¨Ø¹</span>
            </div>
        </div>
    </div>

    <div id="profilePostsContainer" style="padding-bottom: 100px; margin-top: 20px;">
        <p style="width:100%; text-align:center; color:#777; padding: 20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù†Ø´ÙˆØ±Ø§ØªÙƒ...</p>
    </div>

    <div class="bottom-nav">
        <a href="home.html" class="nav-item"><i class="fas fa-home"></i></a>
        <div class="add-post-btn" onclick="openAddPost()"><i class="fas fa-plus"></i></div>
        <div class="nav-item active" onclick="visitMyProfile()"><i class="fas fa-user"></i></div>
    </div>

    <div id="addPostOverlay" class="add-post-overlay">
        <div class="add-post-header">
            <button onclick="closeAddPost()" class="btn-text">Ø¥Ù„ØºØ§Ø¡</button>
            <h3 style="margin:0; color:var(--primary-color)">Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
            <button onclick="saveNewPost()" class="btn-text btn-publish">Ù†Ø´Ø±</button>
        </div>
        <div class="add-post-body">
            <p class="label-green">Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</p>
            <div class="upload-square" onclick="triggerFileUpload()">
                <div style="text-align: center; color: var(--primary-color);">
                    <i class="fas fa-image" style="font-size: 40px; margin-bottom: 10px; display: block;"></i>
                    <div style="font-weight: 600; font-size: 14px;">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</div>
                </div>
                <img id="imagePreview" src="" class="preview-img-box">
                <input type="file" id="postImageInput" accept="image/*" style="display: none;" onchange="previewFile()">
            </div>
            <div class="media-row">
                <div class="media-square" id="audioBox" onclick="triggerAudioUpload()"><i class="fas fa-microphone"></i><input type="file" id="postAudioInput" accept="audio/*" style="display: none;" onchange="handleAudioSelect()"></div>
                <div class="media-square" id="linkBox" onclick="addLink()"><i class="fas fa-link"></i></div>
            </div>
            <p class="label-green">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</p>
            <div class="input-rect" style="position: relative;">
                <input type="text" id="postTitle" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ Ø¬Ø°Ø§Ø¨Ø§Ù‹..." style="padding-right: 40px;">
                <div class="hashtag-icon" onclick="addHashtagInput()" title="Ø£Ø¶Ù Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª">
                    <i class="fas fa-hashtag"></i>
                </div>
                <input type="text" id="postHashtags" placeholder="#Ù‡ÙˆØ¨ÙŠ #Ø´ØºÙÙƒ" class="hashtag-input" style="display: none;">
            </div>
            <p class="label-green">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</p>
            <div class="input-rect"><textarea id="postContent" placeholder="Ø´Ø§Ø±ÙƒÙ†Ø§ Ø£ÙÙƒØ§Ø±Ùƒ..."></textarea></div>
        </div>
    </div>
    <div id="interestsModal" class="modal-popup-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0; color:var(--primary-color)">Ø§Ø®ØªØ± Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ</h3>
            <div class="interests-grid">
                <div class="interest-item"><label><input type="checkbox" name="interest" value="games"> ğŸ® Ø£Ù„Ø¹Ø§Ø¨</label></div>
                <div class="interest-item"><label><input type="checkbox" name="interest" value="art"> ğŸ¨ ÙÙ†</label></div>
                <div class="interest-item"><label><input type="checkbox" name="interest" value="music"> ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰</label></div>
                <div class="interest-item"><label><input type="checkbox" name="interest" value="code"> ğŸ’» Ø¨Ø±Ù…Ø¬Ø©</label></div>
            </div>
            <div style="margin-top:20px; display:flex; gap:10px;">
                <button onclick="closeModal()" style="flex:1; padding:10px; border:none; border-radius:10px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="applyChanges()" style="flex:1; padding:10px; border:none; border-radius:10px; background:var(--primary-color); color:white; cursor:pointer;">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <script type="module" src="main.js"></script>
    
    <script>
        // ÙƒÙˆØ¯ Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡)
        let isOwner = false;
        let currentViewingUser = null;

        window.onload = function() {
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');

            const viewingData = JSON.parse(localStorage.getItem('viewingProfile'));
            
            if (!viewingData || viewingData.isMe) {
                isOwner = true; 
                currentViewingUser = { name: localStorage.getItem('hobbyName') }; 
                loadMyProfile();
            } else {
                isOwner = false; 
                currentViewingUser = viewingData; 
                loadGuestProfile(viewingData);
            }
        }

        function loadMyProfile() {
            document.getElementById("displayPic").src = localStorage.getItem("hobbyImage") || "side.png";
            document.getElementById("displayName").innerHTML = (localStorage.getItem("hobbyName") || "Ø£Ù†Øª") + ' <i class="fas fa-pen edit-icon" onclick="editName()"></i>';
            document.getElementById("displayBio").innerHTML = (localStorage.getItem("hobbyBio") || "Ù…Ø±Ø­Ø¨Ø§Ù‹") + ' <i class="fas fa-pen edit-icon" onclick="editBio()"></i>';
            document.getElementById("editBadge").style.display = "flex";
            document.querySelectorAll(".edit-icon").forEach(el => el.style.display = "inline-block");
            document.getElementById("picContainer").onclick = function() { document.getElementById('fileInput').click(); };
            document.getElementById("followUserBtn").style.display = "none";
            document.getElementById("messageBtn").style.display = "none";
        }

        function loadGuestProfile(data) {
            document.getElementById("displayPic").src = data.img || "side.png";
            document.getElementById("displayName").innerText = data.name;
            document.getElementById("displayBio").innerText = "Ù†Ø¨Ø°Ø© Ø¹Ù† " + data.name;
            document.getElementById("editBadge").style.display = "none";
            document.querySelectorAll(".edit-icon").forEach(el => el.style.display = "none");
            document.getElementById("picContainer").onclick = null;
            document.getElementById("followUserBtn").style.display = "block";
            document.getElementById("messageBtn").style.display = "block";
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø³ÙŠØ·Ø©
        window.editName = function() { let n = prompt("Ø§Ù„Ø§Ø³Ù…:"); if(n) { localStorage.setItem("hobbyName", n); loadMyProfile(); location.reload(); } }
        window.editBio = function() { let b = prompt("Ø§Ù„Ù†Ø¨Ø°Ø©:"); if(b) { localStorage.setItem("hobbyBio", b); loadMyProfile(); } }
        
        const fileInput = document.getElementById('fileInput');
        if(fileInput) {
            fileInput.addEventListener('change', function() {
                const f = this.files[0];
                if(f){ const r = new FileReader(); r.onload = function(e){ localStorage.setItem("hobbyImage", e.target.result); loadMyProfile(); }; r.readAsDataURL(f); }
            });
        }
    </script>
</body>
</html>
